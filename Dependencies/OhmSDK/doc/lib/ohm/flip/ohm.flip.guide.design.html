<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Flip Programming Guide: Designing your Flip Application</title>
<link rel="stylesheet" href="docpage.css" type="text/css" />
</head>

<script type="text/javascript">
function searchfield_focus(obj)
{
obj.style.color="#000"
if (obj.value=="Search Library")
	{obj.value=""}
}
</script>


<body>

<div id="header">
<div style="width: 1006px;">
<!--<form method="get" class="search" style="padding-top: 5px;"  action="http://www.google.com/search">
<input onfocus="searchfield_focus(this)" type="search" class="search" name="q" value="Search Library">
<input type="hidden" name="sitesearch" value="">
</form>-->
</div>
<p><a href="index.html">Ohm Force Developer Library</a><a href="ohm.flip.guide.about.html">Flip Programming Guide</a></p>
</div>

<div id="toc">
<p>Flip Programming Guide</p>
<ul>
<li><a href="ohm.flip.guide.about.html">About Flip Programming Guide</a></li>
<li><a href="ohm.flip.guide.design.html"><strong>Designing your Flip Application</strong></a>
	<ul>
	<li><a href="ohm.flip.guide.design.html#layout">Code Layout</a></li>
	<li><a href="ohm.flip.guide.design.html#converters">Converters</a></li>
	<li><a href="ohm.flip.guide.design.html#verstree">Version Tree</a></li>
	<li><a href="ohm.flip.guide.design.html#class">Converter.txt</a></li>
	<li><a href="ohm.flip.guide.design.html#class">Classes</a></li>
	<li><a href="ohm.flip.guide.design.html#class">Enums</a></li>
	<li><a href="ohm.flip.guide.design.html#fnc">fnc.cpp</a></li>
	</ul>
</li>
<li><a href="ohm.flip.guide.class.html">Writing a Flip Class Part 1</a></li>
<li><a href="ohm.flip.guide.class2.html">Writing a Flip Class Part 2</a></li>
<li><a href="ohm.flip.guide.containers.html">Using Containers</a></li>
<li><a href="ohm.flip.guide.enums.html">Using Enums</a></li>
<li><a href="ohm.flip.guide.blob.html">Using Blobs</a></li>
<li><a href="ohm.flip.guide.objectref.html">Using ObjectRefs</a></li>
<li><a href="ohm.flip.guide.cue.html">Using Cues</a></li>
<li><a href="ohm.flip.guide.navigation.html">Navigating the Model</a></li>
<li><a href="ohm.flip.guide.observer.html">Writing a DocumentObserver</a></li>
<li><a href="ohm.flip.guide.validator.html">Writing a DocumentValidator</a></li>
<li><a href="ohm.flip.guide.undo.html">Using the Undo/Redo system</a></li>
<li><a href="ohm.flip.guide.const.html">Managing Pseudo Const Members</a></li>
<li><a href="ohm.flip.guide.mold.html">Using an ObjectMold</a></li>
<li><a href="ohm.flip.guide.conversion.html">Writing a Converter</a></li>
<li><a href="ohm.flip.guide.tweaker.html">Writing a DocumentTweaker</a></li>
</ul>

<div class="bottomspacer">&nbsp;</div>
</div>

<div id="content">

<div class="nav" align="right"><a href="ohm.flip.guide.about.html">previous</a><span>&nbsp;</span><a href="ohm.flip.guide.class.html">next</a></div>

<h1>Designing your Flip Application</h1>

<p>Ohm Force has been using its Flip framework for years, to make, among other internal
programs, its Ohm Studio application.</p>
<p>Over the years, we have developed a robust workflow to work with Flip. This
chapter describes how you should organize your code in the first place,
to avoid big refactors or headaches at a late stage of development.</p>
<p>This chapter will assume that your company is called ACME making Product and that all your
code reside in
<span class="code">namespace acme::product</span> 
.</p>
<h2><a name="layout">Code Layout</a></h2>
<p>You should separate the model, client and server code in 3 separate folders,
and 3 separate namespaces.</p>
<p>Typically you should create a folder named
<span class="code">model</span> 
in which all classes are
in the
<span class="code">namespace acme::product::model</span> 
. The model is going to be used in both
the client code and the server code. Since the server code is generally going to
be running on linux, you want to avoid avoid dependencies between your model and
code that wouldnâ€™t compile on linux, and would be unnecessary for the server.</p>
<p>In the case that some code of the model would really need to reference other
codes incompatible with the server, you should
<span class="code">#define</span> 
a macro
<span class="code">ohm_flip_SERVER</span> 
to evinct code not needed for the server. As we will
see how to build the server, this method should be however used only when
necessary.</p>
<p>Typically your folder
<span class="code">client</span> 
and
<span class="code">server</span> 
and their associated
namespaces will have a dependency on
<span class="code">model</span> 
.</p>
<div class="codeblock">
<table>
<tr><td><pre>acme/</pre></td></tr>
<tr><td><pre>   product/</pre></td></tr>
<tr><td><pre>      model/</pre></td></tr>
<tr><td><small><pre>         ... model classes ...</pre></small></td></tr>
<tr><td><pre>      client/</pre></td></tr>
<tr><td><small><pre>         ... client classes ...</pre></small></td></tr>
<tr><td><pre>      server/</pre></td></tr>
<tr><td><small><pre>         ... server classes ...</pre></small></td></tr>
</table>
</div>
<h2><a name="converters">Converters</a></h2>
<p>Your
<span class="code">model</span> 
folder should contain a
<span class="code">conv</span> 
folder. It will contains
all your format version changes in a single place. Since Flip format conversion
system is rather flexible, it is very easy to make document format changes,
so you are very likely to make a lot of them.</p>
<p>To avoid polluting the
<span class="code">model</span> 
folder, having it separated in a different
folder is a good solution.</p>
<p>You should name your conversion classes
<span class="code">Converter#1_#2</span> 
where
<span class="code">#1</span> 
would be the
<strong>initial</strong> revision, according to your version source control naming.
In the same fashion,
<span class="code">#2</span> 
would be your
<strong>destination</strong> revision.</p>
<p>For example, the
<span class="code">Converter58186_58939</span> 
class would convert from the model
revision 58156 in our source version control system (
<span class="code">svn</span> 
) to the model
revision 58939.</p>
<div class="codeblock">
<table>
<tr><td><pre>acme/</pre></td></tr>
<tr><td><pre>   product/</pre></td></tr>
<tr><td><pre>      model/</pre></td></tr>
<tr><td><pre>         conv/</pre></td></tr>
<tr><td><small><pre>            ... conversion classes ...</pre></small></td></tr>
</table>
</div>
<h2><a name="verstree">Version Tree</a></h2>
<p>Inside the
<span class="code">conv</span> 
folder, you should maintain a
<span class="code">VersionTree</span> 
class
that will handle format version changes in a tree fashion.</p>
<p>You should name your document format version
<span class="code">#product.Rev#revision</span> 
.
Where
<span class="code">product</span> 
would be your product name maybe prefixed with your
company name, and where
<span class="code">revision</span> 
would be the version source control
revision as described in the previous section.</p>
<p>For example a typical format version would be
<span class="code">ohm.studio.58939</span> 
.</p>
<p>The format version is defined when declaring the root class and marking it
as root, as for example in the following code :</p>
<div class="codeblock">
<table>
<tr><td><pre>ClassDescription &lt;Root&gt;::use ().enable_root ("ohm.studio.58939");</pre></td></tr>
</table>
</div>
<p>A typical version tree code would look as the following :</p>
<div class="codeblock">
<table>
<tr><td><pre>int   VersionTree::do_convert (flip::ConvDocument & document)</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   int err = 0;</pre></td></tr>
<tr><td><pre>   </pre></td></tr>
<tr><td><pre>   bool converted_flag = false;</pre></td></tr>
<tr><td><pre>   </pre></td></tr>
<tr><td><pre>   try </pre></td></tr>
<tr><td><pre>   {</pre></td></tr>
<tr><td><pre>      if ((err == 0) && (document._format_version == "OhmStudio.Beta.Rev67847"))</pre></td></tr>
<tr><td><pre>      {</pre></td></tr>
<tr><td><pre>         Converter67847_68679 converter;</pre></td></tr>
<tr><td><pre>         </pre></td></tr>
<tr><td><pre>         err = converter.process (document);</pre></td></tr>
<tr><td><pre>         </pre></td></tr>
<tr><td><pre>         converted_flag = true;</pre></td></tr>
<tr><td><pre>      }</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>      if ((err == 0) && (document._format_version == "OhmStudio.Beta.Rev68679"))</pre></td></tr>
<tr><td><pre>      {</pre></td></tr>
<tr><td><pre>         Converter68679_69859 converter;</pre></td></tr>
<tr><td><pre>         </pre></td></tr>
<tr><td><pre>         err = converter.process (document);</pre></td></tr>
<tr><td><pre>         </pre></td></tr>
<tr><td><pre>         converted_flag = true;</pre></td></tr>
<tr><td><pre>      }</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>      if (converted_flag)</pre></td></tr>
<tr><td><pre>      {</pre></td></tr>
<tr><td><pre>         document._rev_id += 1;</pre></td></tr>
<tr><td><pre>      }</pre></td></tr>
<tr><td><pre>   }</pre></td></tr>
<tr><td><pre>   catch (...) </pre></td></tr>
<tr><td><pre>   {</pre></td></tr>
<tr><td><pre>      err = flip::Err_EXCEPTION;</pre></td></tr>
<tr><td><pre>   }</pre></td></tr>
<tr><td><pre>   </pre></td></tr>
<tr><td><pre>   return err;</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table>
</div>
<h2><a name="class">Converter.txt</a></h2>
<p>If you are working with many people on a Flip project, many people might
modify the model simulatenously. This is not an issue when developping,
as the server is bundled in the client, and because you can generally
start on a fresh document to test your changes.</p>
<p>However when your application is running in a production environment,
conversion will be need to be done, somehow like migrating a database.
The model changes are therefore scattered over all the Flip classes
which might be not easy when trying to gather all the changes to
write a converter.</p>
<p>Therefore you should maintain a
<span class="code">Converter.txt</span> 
text file, typically
in your
<span class="code">conv</span> 
where you will sum up all the changes needed for the
next conversion, and maybe some directions on how to convert the document.</p>
<div class="warning"><p><strong>WARNING:</strong>Remember that the model is server code. The code contained in
<span class="code">model</span> 
is
dead as seen by the server, but the code from
<span class="code">conv</span> 
is not.</p></div>
<h2><a name="class">Classes</a></h2>
<p>You should name your classes like
<span class="code">acme.product.ClassName</span> 
where
<span class="code">ClassName</span> 
would be the name of your class.</p>
<p>For example a typical class name would be
<span class="code">ohm.studio.Root</span> 
.
It is defined when declaring the class as for example in the following code :</p>
<div class="codeblock">
<table>
<tr><td><pre>ClassDescription &lt;Root&gt;::use ().set_name ("ohm.studio.Root");</pre></td></tr>
</table>
</div>
<p>Generally the
<span class="code">model</span> 
namespace is omitted as it would be redundant.</p>
<h2><a name="class">Enums</a></h2>
<p>You should name your enums like
<span class="code">acme.product.ClassName.EnumName</span> 
where
<span class="code">ClassName</span> 
would be the name of the class containing the enum and
<span class="code">EnumName</span> 
the name of the enum itself.</p>
<p>For example a typical class name would be
<span class="code">ohm.studio.ViewMetrics.Lod</span> 
.
The enum values themselves would be as in the source code, for example
<span class="code">Lod_NORMAL</span> 
.</p>
<p>It is defined when declaring the enum as for example in the following code :</p>
<div class="codeblock">
<table>
<tr><td><pre>class ViewMetrics</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>public:</pre></td></tr>
<tr><td><pre>   enum Lod</pre></td></tr>
<tr><td><pre>   {</pre></td></tr>
<tr><td><pre>      Lod_NORMAL = 0,</pre></td></tr>
<tr><td><pre>      Lod_DETAILED,</pre></td></tr>
<tr><td><pre>   };</pre></td></tr>
<tr><td><pre>};</pre></td></tr>
<tr><td><pre></pre></td></tr>
<tr><td><pre>EnumDescription &lt;Lod&gt;::use ().set_name ("ohm.studio.ViewMetrics.Lod");</pre></td></tr>
<tr><td><pre>EnumDescription &lt;Lod&gt;::use ().push_enum_desc (Lod_NORMAL, "Lod_NORMAL");</pre></td></tr>
<tr><td><pre>EnumDescription &lt;Lod&gt;::use ().push_enum_desc (Lod_DETAILED, "Lod_DETAILED");</pre></td></tr>
</table>
</div>
<p>Generally the
<span class="code">model</span> 
namespace is omitted as it would be redundant.</p>
<h2><a name="fnc">fnc.cpp</a></h2>
<p>Finally your
<span class="code">model</span> 
should contain a
<span class="code">fnc.cpp</span> 
that will at least
handle the declaration of the model. Typically it would look like :</p>
<div class="codeblock">
<table>
<tr><td><pre>void  declare ()</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   flip::ClassDescManager::use_instance ().declare_basic_types ();</pre></td></tr>
<tr><td><pre>   </pre></td></tr>
<tr><td><pre>   ObjectRef::declare ();</pre></td></tr>
<tr><td><pre>   Selection::declare ();</pre></td></tr>
<tr><td><pre>   </pre></td></tr>
<tr><td><small><pre>   ... code skipped ...</pre></small></td></tr>
<tr><td><pre>   </pre></td></tr>
<tr><td><pre>   Root::declare ();</pre></td></tr>
<tr><td><pre>   </pre></td></tr>
<tr><td><pre>   flip::EnumDescManager::use_instance ().post_check ();</pre></td></tr>
<tr><td><pre>   flip::ClassDescManager::use_instance ().post_check ();</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table>
</div>


<div class="nav" align="right"><a href="ohm.flip.guide.about.html">previous</a><span>&nbsp;</span><a href="ohm.flip.guide.class.html">next</a></div>

<div class="bottomspacer">&nbsp;</div>

</div>

<footer>
<a href="index.html">Ohm Force Developer Library</a> > <a href="ohm.flip.guide.about.html">Flip Programming Guide</a> > <a href="ohm.flip.guide.design.html">Designing your Flip Application</a>
</footer>


</body>

</html>