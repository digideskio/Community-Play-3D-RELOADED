<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Flip BabyStep Tutorial: BabyStep 3: Interacting with the Model</title>
<link rel="stylesheet" href="docpage.css" type="text/css" />
</head>

<script type="text/javascript">
function searchfield_focus(obj)
{
obj.style.color="#000"
if (obj.value=="Search Library")
	{obj.value=""}
}
</script>


<body>

<div id="header">
<div style="width: 1006px;">
<!--<form method="get" class="search" style="padding-top: 5px;"  action="http://www.google.com/search">
<input onfocus="searchfield_focus(this)" type="search" class="search" name="q" value="Search Library">
<input type="hidden" name="sitesearch" value="">
</form>-->
</div>
<p><a href="index.html">Ohm Force Developer Library</a><a href="ohm.flip.babystep.about.html">Flip BabyStep Tutorial</a></p>
</div>

<div id="toc">
<p>Flip BabyStep Tutorial</p>
<ul>
<li><a href="ohm.flip.babystep.about.html">About Flip BabyStep Tutorial</a></li>
<li><a href="ohm.flip.babystep.0.html">BabyStep 0: Starting Point</a></li>
<li><a href="ohm.flip.babystep.1.html">BabyStep 1: Binding Flip</a></li>
<li><a href="ohm.flip.babystep.2.html">BabyStep 2: Adding the Root Object</a></li>
<li><a href="ohm.flip.babystep.3.html"><strong>BabyStep 3: Interacting with the Model</strong></a>
	<ul>
	<li><a href="ohm.flip.babystep.3.html#binding.view">Binding the Observer : View part</a></li>
	<li><a href="ohm.flip.babystep.3.html#binding.controller">Binding the Observer : Controller part</a></li>
	</ul>
</li>
</ul>

<div class="bottomspacer">&nbsp;</div>
</div>

<div id="content">

<div class="nav" align="right"><a href="ohm.flip.babystep.2.html">previous</a></div>

<h1>BabyStep 3: Interacting with the Model</h1>

<p>In this chapter, we will bind a graphical element of a GUI to our
<span class="code">ModelRoot</span> 
class.</p>
<h2><a name="binding.view">Binding the Observer : View part</a></h2>
<p>Changes to the document model are reported to the Observers. In this tutorial we
only have one Observer but we could have many, which allows us to isolate code that
reacts to the a model change.</p>
<p>All the changes that are made in a transaction are reported to the
<span class="code">document_changed</span> 
function which is call from the root object. Reacting to a change of the model will be as
simple as traversing the model tree and update the binded object accordingly.
First we will show the general structure of a
<span class="code">document_changed</span> 
function, as this
is always the same code pattern repeated over and over again.
Then we will show how to fill it for our tutorial need.</p>
<div class="codeblock">
<p><strong>Listing</strong>Modifying
<span class="code">BabystepGui.cpp</span> 
</p>
<table>
<tr><td><small><pre>void  BabystepGui::document_changed (ModelRoot & root)</pre></small></td></tr>
<tr><td><small><pre>{</pre></small></td></tr>
<tr><td><strong><pre>   if (root.was_inited ())</pre></strong></td></tr>
<tr><td><strong><pre>   {</pre></strong></td></tr>
<tr><td><strong><pre>      // 1.</pre></strong></td></tr>
<tr><td><strong><pre>   }</pre></strong></td></tr>
<tr><td><strong><pre>   else</pre></strong></td></tr>
<tr><td><strong><pre>   {</pre></strong></td></tr>
<tr><td><strong><pre>      // 2.</pre></strong></td></tr>
<tr><td><strong><pre>   }</pre></strong></td></tr>
<tr><td><strong><pre></pre></strong></td></tr>
<tr><td><strong><pre>   if (root.is_invalid ())</pre></strong></td></tr>
<tr><td><strong><pre>   {</pre></strong></td></tr>
<tr><td><strong><pre>      // 3.</pre></strong></td></tr>
<tr><td><strong><pre>   }</pre></strong></td></tr>
<tr><td><strong><pre></pre></strong></td></tr>
<tr><td><strong><pre>   if (root.was_restored ())</pre></strong></td></tr>
<tr><td><strong><pre>   {</pre></strong></td></tr>
<tr><td><strong><pre>      // 4.</pre></strong></td></tr>
<tr><td><strong><pre>   }</pre></strong></td></tr>
<tr><td><small><pre>}</pre></small></td></tr>
</table>
</div>
<ol>
<li>the object has just been created
</li>
<li>the object is either restored or still resident, but still exists at this point
</li>
<li>the object contains a modification
</li>
<li>the object has been released, we must release its associated ressources.
</li>
</ol>
<p>Now we are going to bind our graphical object to this pattern.</p>
<div class="codeblock">
<p><strong>Listing</strong>Modifying
<span class="code">BabystepGui.cpp</span> 
</p>
<table>
<tr><td><small><pre>void  BabystepGui::document_changed (ModelRoot & root)</pre></small></td></tr>
<tr><td><small><pre>{</pre></small></td></tr>
<tr><td><strong><pre>   BundleRoot * bnd_ptr = 0;</pre></strong></td></tr>
<tr><td><small><pre></pre></small></td></tr>
<tr><td><small><pre>   if (root.was_inited ())</pre></small></td></tr>
<tr><td><small><pre>   {</pre></small></td></tr>
<tr><td><strong><pre>      bnd_ptr = new BundleRoot (root, _window.use_view ());    // 1.</pre></strong></td></tr>
<tr><td><strong><pre>      _window.use_view ().embed (*bnd_ptr, ohm::opa::BundleView::Slot_WORKSPACE);</pre></strong></td></tr>
<tr><td><strong><pre></pre></strong></td></tr>
<tr><td><strong><pre>      root.reset_data (bnd_ptr);                               // 2.</pre></strong></td></tr>
<tr><td><small><pre>   }</pre></small></td></tr>
<tr><td><small><pre>   else</pre></small></td></tr>
<tr><td><small><pre>   {</pre></small></td></tr>
<tr><td><strong><pre>      bnd_ptr = root.get_data &lt;BundleRoot&gt; ();                 // 3.</pre></strong></td></tr>
<tr><td><small><pre>   }</pre></small></td></tr>
<tr><td><small><pre></pre></small></td></tr>
<tr><td><small><pre>   if (root.is_invalid ())</pre></small></td></tr>
<tr><td><small><pre>   {</pre></small></td></tr>
<tr><td><strong><pre>      bnd_ptr-&gt;update ();                                      // 4.</pre></strong></td></tr>
<tr><td><small><pre>   }</pre></small></td></tr>
<tr><td><small><pre></pre></small></td></tr>
<tr><td><small><pre>   if (root.was_restored ())</pre></small></td></tr>
<tr><td><small><pre>   {</pre></small></td></tr>
<tr><td><strong><pre>      delete bnd_ptr;                                          // 5.</pre></strong></td></tr>
<tr><td><strong><pre>      bnd_ptr = 0;</pre></strong></td></tr>
<tr><td><strong><pre></pre></strong></td></tr>
<tr><td><strong><pre>      root.reset_data &lt;BundleRoot&gt; ();                         // 6.</pre></strong></td></tr>
<tr><td><small><pre>   }</pre></small></td></tr>
<tr><td><small><pre>}</pre></small></td></tr>
</table>
</div>
<ol>
<li>create the GUI object and bind it to the window. Note that this object will keep a reference to the model object.
</li>
<li>bind a pointer to the GUI object to the model object...
</li>
<li>... as this allow to get it back between
<span class="code">document_changed</span> 
calls
</li>
<li>call the function which will update our GUI to match the model
</li>
<li>root is destroyed, remove the GUI object
</li>
<li>unbind the pointer to the GUI object from the model object
</li>
</ol>
<p>The following code shows the implementation of the
<span class="code">update</span> 
call.</p>
<div class="codeblock">
<p><strong>Listing</strong>Modifying
<span class="code">BundleRoot.cpp</span> 
</p>
<table>
<tr><td><pre>void  BundleRoot::update ()</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   if (_root.point_changed ())</pre></td></tr>
<tr><td><pre>   {</pre></td></tr>
<tr><td><pre>      _prim_aptr-&gt;_point = ohm::opa::Point (_root.get_point_x (), _root.get_point_y ());</pre></td></tr>
<tr><td><pre>   }</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table>
</div>
<h2><a name="binding.controller">Binding the Observer : Controller part</a></h2>
<p>User inputs can be translated into model changes by simply changing the model
directly. The following code shows how this is done. The
<span class="code">move</span> 
function
is called from the GUI element that interprets the user inputs.</p>
<div class="codeblock">
<p><strong>Listing</strong>Modifying
<span class="code">BundleRoot.cpp</span> 
</p>
<table>
<tr><td><pre>void  BundleRoot::move (const ohm::opa::Point & point)</pre></td></tr>
<tr><td><pre>{</pre></td></tr>
<tr><td><pre>   _root.set_point (point._x, point._y);</pre></td></tr>
<tr><td><pre>}</pre></td></tr>
</table>
</div>


<div class="nav" align="right"><a href="ohm.flip.babystep.2.html">previous</a></div>

<div class="bottomspacer">&nbsp;</div>

</div>

<footer>
<a href="index.html">Ohm Force Developer Library</a> > <a href="ohm.flip.babystep.about.html">Flip BabyStep Tutorial</a> > <a href="ohm.flip.babystep.3.html">BabyStep 3: Interacting with the Model</a>
</footer>


</body>

</html>